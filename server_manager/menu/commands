#!/usr/bin/env bash

menu_run_ctl() {
  local cmd
  cmd="$1"
  ui_hr
  ui_note "Running: ctl $cmd"
  echo
  # Use the canonical entrypoint path to avoid PATH issues.
  /usr/local/etc/enshrouded/entrypoints/ctl "$cmd" || true
  echo
  ui_pause
}

menu_other_commands() {
  local choice
  while :; do
    if menu_nav_is_set; then
      return 0
    fi
    ui_header "Other ctl Commands"

    ui_opt 1 "status"
    ui_opt 2 "scheduled-restart"
    ui_opt 3 "bootstrap"
    ui_opt 4 "cron-start"
    ui_opt 5 "cron-stop"
    ui_opt 6 "cron-restart"
    echo
    ui_actions_bar "0 Back" "m Main" "x Exit"
    echo
    choice="$(ui_prompt_choice "Choice")"
    choice="$(echo "$choice" | tr '[:upper:]' '[:lower:]' | xargs)"
    case "$choice" in
      1) menu_run_ctl status ;;
      2) menu_run_ctl scheduled-restart ;;
      3) menu_run_ctl bootstrap ;;
      4) menu_run_ctl cron-start ;;
      5) menu_run_ctl cron-stop ;;
      6) menu_run_ctl cron-restart ;;
      0) return 0 ;;
      m)
        menu_nav_set "main"
        return 0
        ;;
      x|q)
        menu_nav_set "exit"
        return 0
        ;;
      *)
        ui_warn_line "Invalid selection."
        ui_pause
        ;;
    esac
  done
}
