# Changelog

This changelog describes the current `server_manager` as an **initial release** (greenfield setup).

See also: Dev branch logs (unofficial): [`docs/changelog/dev-logs.md`](dev-logs.md)

## [2.2.0-init]

### Target State
- Container operation with stable process supervision
- Clear separation of entry points, jobs, shared logic, runtime, and profiles
- Profile-based provisioning for manager and Enshrouded configuration
- Reproducible administration via fixed container commands

---

### New (Initial)

#### 1. Supervisor-Based Architecture
- `supervisord` is the central process supervisor.
- Each operating case is modeled as a Supervisor program (server, update, backup, restart, reset, cron).
- Jobs run isolated, controlled, and consistently under Supervisor.

**Why Supervisor?**
- Defined start/stop lifecycles per job
- Unified control via `supervisorctl`
- Clean restart/failure behavior
- Clear separation between long-running processes and one-shot jobs

Active program names:
- `enshrouded-bootstrap`
- `enshrouded-server`
- `enshrouded-updater`
- `enshrouded-backup`
- `enshrouded-restart`
- `enshrouded-force-update`
- `server-manager-profil-reset`
- `enshrouded-profile-reset`
- `crond`

---

#### 2. Server Manager Structure
The code is organized by responsibility:

- `server_manager/entrypoints/`
  - external entry points (`bootstrap`, `ctl`)
- `server_manager/jobs/`
  - supervisor-controlled one-shot jobs
- `server_manager/shared/`
  - shared logic (`common`, `env`, `profile`, shared helpers)
- `server_manager/runtimes/proton/`
  - Proton-bound runtime scripts
- `server_manager/profiles/manager/`
  - manager profile templates
- `server_manager/profiles/enshrouded/`
  - Enshrouded profile templates
- `server_manager/supervisor/`
  - Supervisor configuration
- `docs/`
  - project documentation

---

#### 3. Profile System (Manager + Enshrouded)
Two independent profile types:

- **Manager profile** (`MANAGER_PROFILE`)
  - controls `server_manager.json`
- **Enshrouded profile** (`EN_PROFILE`)
  - controls `enshrouded_server.json`

Template paths:
- `server_manager/profiles/manager/<name>_server_manager.json`
- `server_manager/profiles/enshrouded/<name>_enshrouded_server.json`

Runtime files:
- `/home/enshrouded/server/server_manager/server_manager.json`
- `/home/enshrouded/server/enshrouded_server.json`

---

#### 4. Reset Strategy
There are two dedicated reset cases:

- `server-manager-profil-reset`
  - resets the manager config from `MANAGER_PROFILE`
- `enshrouded-profile-reset`
  - resets the Enshrouded config from `EN_PROFILE`

Both stop `supervisord` afterwards, so the container can restart cleanly with fresh configuration.

---

#### 5. Operational Commands (`ctl`)
Available commands:
- `status`
- `menu` (interactive shell menu)
- `start`
- `stop`
- `restart`
- `update`
- `backup`
- `password-view` (lists `userGroups` incl. permissions + passwords from the active `enshrouded_server.json`)
- `scheduled-restart`
- `force-update`
- `server-manager-profil-reset`
- `enshrouded-profile-reset`
- `bootstrap`
- `cron-start`
- `cron-stop`
- `cron-restart`

Usage:
- `docker exec CONTAINER_NAME <command>`
- or `docker exec CONTAINER_NAME ctl <command>`

---

#### 6. Logging Basics
- Consistent log helpers in `shared/common`
- Log colors controlled via `LOG_COLOR` (`true|false`)
- Colored output only with a TTY
- Supervisor/syslog integration for container-friendly stdout/stderr output

---

#### 7. Build Integration
The `Dockerfile` is aligned with the new structure:
- focused `COPY` steps per functional area
- symlink-based command exposure via `ctl`
- start via `entrypoints/bootstrap`

---

### Technical Status
This is an **initial changelog** for the current architecture (not a historical delta log).  
The items listed here describe the current intended/actual state of the system.
