# Changelog

Dieser Changelog beschreibt den aktuellen `server_manager` als **Initial-Release** (Greenfield-Setup).

## [2.2.0-init]

### Zielbild
- Containerbetrieb mit stabiler Prozessaufsicht
- Klare Trennung von Entry Points, Jobs, Shared-Logik, Runtime und Profilen
- Profilbasiertes Provisioning für Manager- und Enshrouded-Konfiguration
- Reproduzierbare Administration über feste Container-Commands

---

### Neu (Initial)

#### 1. Supervisor-basierte Architektur
- `supervisord` ist die zentrale Prozessaufsicht.
- Jeder Betriebsfall ist als Supervisor-Programm modelliert (Server, Update, Backup, Restart, Reset, Cron).
- Jobs laufen isoliert, kontrolliert und einheitlich unter Supervisor.

**Warum Supervisor?**
- Definierte Start-/Stop-Lebenszyklen pro Job
- Einheitliche Steuerung über `supervisorctl`
- Sauberes Restart-/Failure-Verhalten
- Klare Trennung zwischen dauerhaften Prozessen und Einmal-Jobs

Aktive Programmnamen:
- `enshrouded-bootstrap`
- `enshrouded-server`
- `enshrouded-updater`
- `enshrouded-backup`
- `enshrouded-restart`
- `enshrouded-force-update`
- `profile-reset`
- `enshrouded-profile-reset`
- `crond`

---

#### 2. Strukturierung des Server Managers
Der Code ist funktional gegliedert:

- `server_manager/entrypoints/`
  - externe Startpunkte (`bootstrap`, `ctl`)
- `server_manager/jobs/`
  - supervisor-gesteuerte Einzeljobs
- `server_manager/shared/`
  - gemeinsam genutzte Logik (`common`, `env`, `profile`, shared helpers)
- `server_manager/runtimes/proton/`
  - Proton-gebundene Runtime-Skripte
- `server_manager/profiles/manager/`
  - Manager-Profiltemplates
- `server_manager/profiles/enshrouded/`
  - Enshrouded-Profiltemplates
- `server_manager/supervisor/`
  - Supervisor-Konfiguration
- `server_manager/docs/`
  - projektspezifische Dokumentation

---

#### 3. Profilsystem (Manager + Enshrouded)
Zwei unabhängige Profilarten:

- **Manager-Profil** (`MANAGER_PROFILE`)
  - steuert `server_manager.json`
- **Enshrouded-Profil** (`EN_PROFILE`)
  - steuert `enshrouded_server.json`

Template-Pfade:
- `server_manager/profiles/manager/<name>_server_manager.json`
- `server_manager/profiles/enshrouded/<name>_enshrouded_server.json`

Laufzeitdateien:
- `/home/enshrouded/server/server_manager/server_manager.json`
- `/home/enshrouded/server/enshrouded_server.json`

---

#### 4. Reset-Strategie
Es gibt zwei gezielte Reset-Fälle:

- `profile-reset`
  - setzt Manager-Konfig aus `MANAGER_PROFILE` zurück
- `enshrouded-profile-reset`
  - setzt Enshrouded-Konfig aus `EN_PROFILE` zurück

Beide stoppen danach `supervisord`, damit ein sauberer Neustart mit frischen Konfigurationen erfolgt.

---

#### 5. Operative Commands (`ctl`)
Verfügbare Commands:
- `status`
- `start`
- `stop`
- `restart`
- `update`
- `backup`
- `scheduled-restart`
- `force-update`
- `profile-reset`
- `enshrouded-profile-reset`
- `bootstrap`
- `cron-start`
- `cron-stop`
- `cron-restart`

Nutzung:
- `docker exec <container> <command>`
- oder `docker exec <container> ctl <command>`

---

#### 6. Logging-Grundlagen
- Einheitliche Logfunktionen in `shared/common`
- Log-Farben steuerbar über `LOG_COLOR` (`true|false`)
- Farbige Ausgabe nur bei TTY
- Supervisor-/Syslog-Integration für containerfreundliche Ausgabe nach stdout/stderr

---

#### 7. Build-Integration
`Dockerfile` ist auf die neue Struktur ausgerichtet:
- gezielte `COPY`-Schritte je Funktionsbereich
- Symlink-basierte Command-Exposition über `ctl`
- Start über `entrypoints/bootstrap`

---

### Technischer Status
Dies ist ein **Initial-Changelog** für die aktuelle Architektur (kein historischer Delta-Verlauf).  
Die hier gelisteten Punkte beschreiben den aktuellen Soll-/Ist-Stand des Systems.
